<canvas id="game" width="500" height="500">

<script>
var tilesize = 5;

var steps = {
    right:{
        weight:9,
        minx:4,
        maxx:7,
        miny:0,
        maxy:2   
    }
}

var Box = function(x, y, w, h){
    this.minx = x;
    this.maxx = x + w;

    this.miny = y;
    this.maxy = y + h;
}

var worldSize = {
    x:50,
    y:50
}

var world = [];

var random = function(min, max){
    return Math.floor(Math.random() * (max + 1 - min) + min);
}

var display = function(){
    var canvas = document.querySelector("#game");
    var ctx = canvas.getContext("2d");

    for(var i in world){
        for(var j in world[i]){
            if(world[i][j] == 1){
                ctx.fillRect(i * tilesize, j * tilesize, tilesize, tilesize);
            }
        }
    }

}



var init = function(){
    for(var i in Moves){
        Moves[i].poids = 0;
        for(var j in Moves[i].suite){
            Moves[i].poids += Moves[i].suite[j];
        }
    }

    world = [];
    for(var i = 0; i < worldSize.x; i++){
        world[i] = [];
        for(var j = 0; j < worldSize.y; j++){
            world[i][j] = 0;
        }
    }

    console.log(Moves);
}

var Position = {
    x:20,
    y:20
}


init();

var currentState = "init";
for(var boucle = 0; boucle < 10; boucle++){


    var middleX = Math.floor(Moves[currentState].move.length/2);
    var middleY = Math.floor(Moves[currentState].move[0].length/2);


    for(var i in Moves[currentState].move){
        for(var j in Moves[currentState].move[i]){
            if(Moves[currentState].move[i][j] != 0){
                world[Position.x + parseInt(i) - middleX][Position.y + parseInt(j) - middleY]  = 1;
                if(Moves[currentState].move[i][j] == 2){
                    Position.x += i - middleX;
                    Position.y += j - middleY;
                }
            }
        }
    }

    console.log(currentState, Position.x+"/"+Position.y);


    var next = random(0, Moves[currentState].poids);

    var sum = 0;
    for(var i in Moves[currentState].suite){
        sum += Moves[currentState].suite[i];
        if(sum >= next){
            currentState = i;
            break;
        }
    }

}

display();


</script>